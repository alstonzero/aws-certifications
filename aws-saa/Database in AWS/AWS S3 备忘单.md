# AWS S3 备忘单

Amazon S3 是一种对象存储(object storage)，旨在从 Internet 上的任何位置存储和检索任意数量的数据。

它是一种简单的存储服务，以极低的成本提供极其耐用、高度可用且可无限扩展的数据存储基础架构。

Amazon S3 是一种分布式架构，对象冗余存储在 Amazon S3 区域中跨多个设施 (AZ) 的多个设备上。

Amazon S3 是一个简单的基于键(key-based)的对象存储。

键可以是任何字符串，并且可以构造它们来模拟分层属性。

或者，您可以使用 S3 对象标记来跨所有 S3 存储桶和/或前缀组织数据。

Amazon S3 提供了一个简单的、基于标准的 REST Web 服务接口，旨在与任何 Internet 开发工具包配合使用。

文件可以从 0 字节到 5TB。

单个 PUT 中可以上传的最大对象为 5 GB。

对于大于 100 MB的对象，请使用分段上传(Multipart Upload)功能。

对象的更新是原子的(atomic)——当读取一个更新的对象时，你要么得到新对象，要么得到旧对象，你永远不会得到部分或损坏的数据。

有无限的可用存储空间。

建议通过 SDK 和 API 访问 S3（控制台使用 API）。

特定操作的事件通知，可以发送警报或触发操作。

通知可发送至：

- SNS 话题。
- SQS 队列。
- Lambda 函数。
- 在 S3 之前需要配置 SNS/SQS/Lambda。
- S3 不收取额外费用，但您需要为 SNS、SQS 和 Lambda 付费。

请求者付费功能使请求者付费（去除匿名访问）。

可以提供对对象的限时访问。

为新对象的 PUTS 提供读写一致性(read after write consistency)。

为覆盖 PUTS 和 DELETES 提供最终一致性（需要时间传播）。

您只能在 S3 上存储文件（对象）。

HTTP 200 代码表示成功写入 S3。

S3 数据由以下部分组成：

- 键（名称）。Key (name)
- 值（数据）。Value (data)
- 版本标识。Version ID
- 元数据。Metadata
- 访问控制列表。Access Control Lists

Amazon S3 自动扩展到高请求率。

例如，您的应用程序可以在存储桶中实现每个前缀每秒至少 3,500 个 PUT/POST/DELETE 和 5,500 个 GET 请求。

一个桶中的前缀数量没有限制。

对于读取密集型请求，您还可以使用 CloudFront 边缘站点(CloudFront edge locations)从 S3 卸载。

## 附加功能

Amazon S3 提供的其他功能包括：

![Amazon S3 附加功能](https://cdn-digicloud.pressidium.com/wp-content/uploads/2019/03/Amazon-S3-Additional-Capabilities-1024x521.jpg)

## 用例

典型用例包括：

- **备份与存储** ——为他人提供数据备份与存储服务。
- **应用程序托管** – 提供部署、安装和管理 Web 应用程序的服务。
- **媒体托管** – 构建冗余、可扩展且高度可用的基础架构，用于托管视频、照片或音乐的上传和下载。
- **软件交付** – 托管客户可以下载的软件应用程序。
- **静态网站**– 您可以将静态网站配置为从 S3 存储桶运行。

S3 是一个持久的、高度持久的数据存储。

持久数据存储是非易失性存储系统，可在断电时保留数据。

这与在断电时丢失数据的瞬态数据存储和临时数据存储形成对比。

下表提供了持久性、瞬态和临时数据存储以及要使用的 AWS 服务的描述：

![AWS 数据存储用例](https://cdn-digicloud.pressidium.com/wp-content/uploads/2019/03/AWS-Data-Store-Use-Cases-1024x439.jpg)

## 桶(Buckets)

文件存储在桶中：

- 可以将存储桶视为对象的容器。
- 桶是一个扁平的物体容器。
- 它不提供对象的层次结构。
- 您可以使用对象键名称（前缀）来模拟文件夹。

默认每个账户 100 个存储桶。

您可以在存储桶中存储无限的对象。

您可以在存储桶中创建文件夹（仅可通过控制台使用）。

您不能创建嵌套存储桶。

存储桶所有权不可转让。

存储桶名称在创建后无法更改。

如果删除存储桶，其名称将再次可用。

存储桶名称是用于访问存储桶的 URL 的一部分。

S3 存储桶是特定于区域的。

S3 是一个通用命名空间，因此名称必须全局唯一。

URL 采用以下格式：https:// s3 **-eu-west-1** .amazonaws.com/ **<bucketname>。**

可以将一个bucket备份到另一个账户中的另一个bucket。

可以启用日志记录到存储桶。

桶命名：

- 存储桶名称的长度必须至少为 3 个字符且不超过 63 个字符。
- 存储桶名称必须以小写字符或数字开头和结尾。
- 存储桶名称必须是一系列以句点分隔的一个或多个标签。
- 存储桶名称可以包含小写字母、数字和连字符。
- 存储桶名称不能格式化为 IP 地址。

为了获得更好的性能、更低的延迟和更低的成本，请创建更靠近您的客户的存储桶。

## 对象

每个对象都通过唯一的键（ID 或名称）进行存储和检索。

S3 中的对象通过以下方式唯一标识和寻址：

- 服务终点。
- 存储桶名称。
- 对象键（名称）。
- （可选）对象版本。

存储在存储桶中的对象永远不会离开存储它们的区域，除非您将它们移动到另一个区域或启用跨区域复制。

您可以在上传时和之后的任何时间使用 AWS 管理控制台定义对对象的权限。

## 子资源

子资源从属于对象，它们不是独立存在的，而是始终与另一个实体（例如对象或存储桶）相关联。

与桶关联的子资源（配置容器）包括：

- 生命周期 - 定义对象的生命周期。
- 网站 – 用于托管静态网站的配置。
- 版本控制——在对象更改时保留对象的多个版本。
- 访问控制列表 (ACL) – 控制对存储桶的权限访问。
- 存储桶策略 – 控制对存储桶的访问。
- 跨源资源共享 (CORS)。
- 记录。

与对象相关的子资源包括：

- ACL – 定义访问对象的权限。
- 恢复 - 恢复存档。

## 存储类(Storage Classes)

有六个 S3 存储类。

- S3 标准(S3 Standard)（耐用、立即可用、经常访问）。
- S3 智能分层(S3 Intelligent-Tiering)（自动将数据移动到最具成本效益的层）。
- S3 标准-IA(S3 Standard-IA)（耐用、立即可用、不常访问）。
- S3 One Zone-IA(S3 One Zone-IA)（不常访问的数据成本较低，弹性较低）。
- S3 Glacier（存档数据，以分钟或小时为单位的检索时间）。
- S3 Glacier Deep Archive（用于长期保留的最低成本存储类）。

下表提供了每个 Amazon S3 存储类的详细信息：

![Amazon S3 存储类](https://cdn-digicloud.pressidium.com/wp-content/uploads/2019/10/Amazon-S3-Storage-Classes.png)

存储在 S3 One Zone-IA 存储类中的对象冗余存储在您选择的 AWS 区域的单个可用区中。

## 访问和访问策略

有四种机制可用于控制对 Amazon S3 资源的访问：

- IAM 政策(IAM policies)。
- 桶政策(Bucket policies)。
- 访问控制列表(Access Control Lists) (ACL)。
- 查询字符串身份验证(Query string authentication)（仅在有限时间内有效的 Amazon S3 对象的 URL）。

可以通过配置 Amazon S3 存储桶来为针对它发出的所有请求创建访问日志记录来配置访问审核。

要在日志中捕获 IAM/用户身份信息(IAM/user identity)，请配置 AWS CloudTrail 数据事件。

默认情况下，存储桶、其对象和相关子资源都是私有的。

默认情况下，只有资源所有者可以访问存储桶。

资源所有者是指创建资源的 AWS 账户。

对于 IAM，账户所有者而非 IAM 用户是所有者。

在 IAM 策略中，您可以授予对 Amazon S3 资源的编程访问权限或 AWS 管理控制台访问权限。

Amazon 资源名称 (ARN) 用于在策略中指定资源。

AWS 上任何资源的格式为：

`arn:partition:service:region:namespace:relative-id`。

对于 S3 资源：

- aws 是一个常见的分区名称。
- s3 是服务。
- 您没有指定区域和命名空间。
- 对于 Amazon S3，它可以是存储桶名称或存储桶名称/对象键。您可以使用通配符(wild card)。

S3 资源的格式为：

`arn:aws:s3:::bucket_name`。

`arn:aws:s3:::bucket_name/key_name`。

存储桶所有者可以向另一个 AWS 账户（或账户中的用户）授予跨账户权限，以上传对象。

- 上传对象的 AWS 账户拥有它们。
- 存储桶所有者对其他账户拥有的对象没有权限，但是：
  - 桶所有者支付费用。
  - 存储桶所有者可以拒绝对任何对象的访问，而不管其所有权如何。
  - 存储桶所有者可以归档任何对象或恢复已归档的对象，而不管其所有权如何。

可以授予对存储桶和对象的访问权限：

- 个人用户。
- AWS 账户。
- 每个人（公开/匿名）。
- 所有经过身份验证的用户（AWS 用户）。

访问策略定义对资源的访问，并且可以与资源（存储桶和对象）和用户相关联。

您可以使用 AWS 策略生成器为您的 Amazon S3 存储桶创建存储桶策略。

策略的类别是基于资源的策略和用户策略。

基于资源的策略：

- 附加到存储桶和对象。
- 基于 ACL 的策略定义权限。
- ACL 可用于向其他帐户授予读/写权限。
- 存储桶策略可用于授予其他 AWS 账户或 IAM 用户对存储桶和对象的权限。

用户政策：

- 可以使用 IAM 来管理对 S3 资源的访问。
- 使用 IAM，您可以创建用户、组和角色，并将访问策略附加到他们，授予他们对资源的访问权限。
- 您无法在 IAM 用户策略中授予匿名权限，因为该策略已附加到用户。
- 用户策略可以向存储桶及其中的对象授予权限。

ACL：

- S3 ACL 使您能够管理对存储桶和对象的访问。
- 每个存储桶和对象都有一个附加到它的 ACL 作为子资源。
- 存储桶和对象权限相互独立。
- ACL 定义了哪些 AWS 账户（被授予者）或预定义的 S3 组被授予访问权限以及访问类型。
- 受让人可以是 AWS 账户或预定义的 Amazon S3 组之一。
- 当您创建存储桶或对象时，S3 会创建一个默认 ACL，授予资源所有者对该资源的完全控制权。

跨账户访问：

- 您使用电子邮件地址或规范用户 ID 向另一个 AWS 账户授予权限。
- 但是，如果您在授权请求中提供电子邮件地址，Amazon S3 会查找该账户的规范用户 ID 并将其添加到 ACL。
- 然后，受让人帐户可以将其他帐户提供的访问权限委托给其个人用户。

## 预定义组

经过身份验证的用户组：

- 该组代表所有 AWS 账户。
- 该组的访问权限允许任何 AWS 账户访问资源。
- 所有请求都必须签名（经过身份验证）。
- 任何经过身份验证的用户都可以访问该资源。

所有用户组：

- 对该组的访问权限允许世界上的任何人访问该资源。
- 请求可以是签名的（经过身份验证的）或未签名的（匿名的）。
- 未签名的请求会省略请求中的身份验证标头。
- AWS 建议您永远不要授予所有用户组 WRITE、WRITE_ACP 或 FULL_CONTROL 权限。

日志传送组：

- 在存储桶上为该组提供 WRITE 权限使 S3 能够写入服务器访问日志。
- 不适用于对象。

下表列出了 Amazon S3 在 ACL 中支持的权限集。

- 对象 ACL 和存储区 ACL 的 ACL 权限集相同。
- 根据上下文（存储桶 ACL 或对象 ACL），这些 ACL 权限授予特定存储桶或对象操作的权限。
- 该表列出了权限并描述了它们在对象和存储桶的上下文中的含义。

![存储桶和对象的 ACL 权限](https://cdn-digicloud.pressidium.com/wp-content/uploads/2018/07/ACL-Permissions-for-Buckets-and-Objects.jpg)

请注意以下事项：

- 在帐户级别为经过身份验证的用户分配权限。
- 您不能为单个 IAM 用户分配权限。
- 当对存储桶授予读取权限时，它仅提供列出存储桶中对象的能力。
- 当对对象授予读取权限时，可以读取数据。
- ACP 表示访问控制权限和 READ_ACP/WRITE_ACP 控制谁可以自己读/写 ACL。
- WRITE 仅适用于桶级别（ACP 除外）。

存储桶策略的大小限制为 20 KB。

每个 ACL 的对象 ACL 限制为 100 个授予的权限。

存储桶 ACL 的唯一推荐用例是向 S3 日志传输组授予写入权限。

使用 ACL 管理权限存在限制：

- 您不能向单个用户授予权限。
- 您不能授予有条件的权限。
- 您不能明确拒绝访问。

在授予其他 AWS 账户上传对象的权限时，这些对象的权限只能由对象所有者使用对象 ACL 进行管理。

您可以将存储桶策略用于：

- 授予用户对您账户拥有的存储桶的权限。
- 管理对象权限（其中对象所有者与存储桶所有者是同一个账户）。
- 管理所有 Amazon S3 权限的跨账户权限。

您可以将用户策略用于：

- 授予所有 Amazon S3 操作的权限。
- 管理您帐户中用户的权限。
- 向帐户内的用户授予对象权限。

要让 IAM 用户访问另一个账户中的资源，必须提供以下信息：

- 通过用户策略从父帐户获得权限。
- 资源所有者通过存储桶策略授予 IAM 用户的权限，或通过存储桶策略、存储桶 ACL 或对象 ACL 授予父账户的权限。

如果 AWS 账户拥有资源，它可以向另一个账户授予权限，然后该账户可以将这些权限或其中的一部分委托给账户中的用户（权限委托）。

从另一个账户接收权限的账户不能将权限跨账户委派给第三个 AWS 账户。

## 收费

同一地区的 EC2 和 S3 之间传输数据不收费。

将数据传输到 S3 是免费的。

传输到其他地区的数据是收费的。

数据检索（适用于 S3 Standard-IA 和 S3 One Zone-IA、S3 Glacier 和 S3 Glacier Deep Archive）。

收费如下：

- 每 GB/月的存储费用。
- 数据从 S3 传出。
- 上传请求（PUT 和 GET）。
- 检索请求（S3-IA 或 Glacier）。

请求者支付：

- 存储桶所有者只需支付对象存储费用。
- 请求者将为请求（上传/下载）和数据传输付费。
- 只能在存储桶级别启用。

## 分段上传

可用于加速上传到 S3。

分段上传可独立、并行和以任意顺序分段上传对象。

使用 S3 分段上传 API 执行。

推荐用于 100MB 或更大的对象。

- 可用于 5MB 到 5TB 的对象。
- 必须用于大于 5GB 的对象。

如果任何部分的传输失败，则可以重新传输。

提高吞吐量。

可以暂停和恢复对象上传。

可以在知道最终对象大小之前开始上传。

## 复制

您可以在单个原子操作中创建最大 5GB 的对象副本。

对于大于 5GB 的文件，您必须使用分段上传 API。

可以使用 AWS 开发工具包或 REST API 执行。

复制操作可用于：

- 生成对象的额外副本。
- 重命名对象。
- 更改副本的存储类别或静态加密。
- 跨 AWS 位置/区域移动对象。
- 更改对象元数据。

一旦上传到 S3，一些对象元数据就无法更改，复制对象可以让您修改这些信息。

## 传输加速

Amazon S3 Transfer Acceleration 支持在您的客户端和您的 Amazon S3 存储桶之间实现快速、轻松和安全的长距离文件传输。

S3 Transfer Acceleration 利用 Amazon CloudFront 全球分布的 AWS 边缘站点。

用于加速对象长距离（延迟）上传到 S3。

传输加速与直接上传到 S3 一样安全。

只有在转移时间有好处时才会向您收费。

需要在 S3 存储桶上启用传输加速。

不能禁用，只能暂停。

可能需要长达 30 分钟才能实施。

URL 是：<bucketname>.s3-accelerate.amazonaws.com。

存储桶名称必须符合 DNS 要求，并且标签之间不能有句点。

现在符合 HIPAA 标准。

您可以使用带传输加速的分段上传。

必须使用以下端点之一：

- .s3-accelerate.amazonaws.com。
- .s3-accelerate.dualstack.amazonaws.com（双栈选项）。

S3 Transfer Acceleration 支持所有存储桶级别的功能，包括分段上传。

## 静态网站

S3 可用于托管静态网站。

不能使用动态内容，如 PHP、.Net 等。

自动缩放。

您可以使用 Route 53 别名记录在 S3 中使用自定义域名。

使用自定义域名时，存储桶名称必须与域名相同。

可以为整个域、页面或特定对象启用重定向。

URL 是：`<bucketname>.s3-website-.amazonaws.com`。

请求者付款不适用于网站端点。

不支持 HTTPS/SSL。

返回一个 HTML 文档。

支持对象和桶级重定向。

仅支持对对象的 GET 和 HEAD 请求。

仅支持公开可读的内容。

要在存储桶上启用网站托管，请指定：

- 索引文档（默认网页）。
- 错误文档（可选）。

![S3 REST API 端点和网站端点之间的区别](https://cdn-digicloud.pressidium.com/wp-content/uploads/2018/07/Difference-between-S3-REST-API-Endpoints-and-Website-Endpoints.jpg)

## 预签名 URL

预签名 URL 可用于为没有 AWS 凭证的人提供对特定对象的临时访问权限。

默认情况下，所有对象都是私有的，只能由所有者访问。

要共享对象，您可以将其设为公开或生成预先签名的 URL。

必须配置到期日期和时间。

这些可以使用适用于 Java 和 .Net 的开发工具包以及适用于 Visual Studio 的 AWS 资源管理器生成。

可用于下载和上传 S3 对象。

## 版本控制(Versioning)

版本控制存储对象的所有版本（包括所有写入，即使对象被删除）。

版本控制可防止意外的对象/数据删除或覆盖。

启用“回滚(roll-back)”和“取消删除(un-delete)”功能。

版本控制还可用于数据保留和存档。

旧版本计为计费大小，直到它们被永久删除。

启用版本控制不会复制现有对象。

可用于备份。

一旦启用版本控制不能禁用只能暂停。

可以与生命周期规则集成。

可以启用多因素身份验证 (MFA) 删除。

MFA 删除也可应用于更改版本控制设置。

MFA 删除适用于：

- 更改存储桶的版本控制状态。
- 永久删除对象。

跨区域复制需要在源和目标存储桶上启用版本控制。

不会复制恢复到以前的版本。

默认情况下，HTTP GET 检索最新版本。

启用版本控制后，只有 S3 存储桶所有者才能永久删除对象。

当您尝试删除启用了版本控制的对象时，会在该对象上放置一个 DELETE 标记。

您可以删除 DELETE 标记，该对象将再次可用。

使用版本控制删除会复制删除标记。但是删除删除标记不会被复制。

存储桶版本控制状态：

- 启用。
- 版本化。
- 无版本。

在启用版本控制之前存在的对象的版本 ID 将为 NULL。

暂停：

- 如果您暂停版本控制，现有对象将保持原样，但不会创建新版本。
- 当版本控制暂停时，新对象的版本 ID 将为 NULL，上传的同名对象将覆盖现有对象。

## 对象生命周期管理

用于优化存储成本、遵守数据保留策略并保持 S3 卷得到良好维护。

甲 *生命周期配置* 是一组定义，亚马逊S3适用于一组对象的行动规则。有两种类型的操作：

- **转换操作**- 定义对象转换到另一个 [存储类的时间](https://docs.aws.amazon.com/AmazonS3/latest/dev/storage-class-intro.html)。例如，您可以选择在创建对象 30 天后将对象转换为 STANDARD_IA 存储类，或者在创建对象一年后将对象存档到 GLACIER 存储类。

存在与生命周期转换请求相关的成本。有关定价信息，请参阅 [Amazon S3 定价](https://aws.amazon.com/s3/pricing/)。

- **过期操作**- 定义对象何时过期。Amazon S3 代表您删除过期的对象。

生命周期配置是在存储桶级别作为子资源应用的 XML 文件。

可与版本控制结合使用或独立使用。

可以应用于当前和以前的版本。

可以应用于存储桶中的特定对象：具有特定标签的对象或具有特定前缀的对象。

### 支持的转换和相关约束

Amazon S3 支持使用生命周期配置在存储类之间进行以下生命周期转换：

- 您可以从 STANDARD 存储类转换到任何其他存储类。
- 您可以从任何存储类转换到 GLACIER 或 DEEP_ARCHIVE 存储类。
- 您可以从 STANDARD_IA 存储类过渡到 INTELLIGENT_TIERING 或 ONEZONE_IA 存储类。
- 您可以从 INTELLIGENT_TIERING 存储类过渡到 ONEZONE_IA 存储类。
- 您可以从 GLACIER 存储类过渡到 DEEP_ARCHIVE 存储类。

不支持以下生命周期转换：

- 您无法从任何存储类转换到 STANDARD 存储类。
- 您无法从任何存储类转换到 REDUCED_REDUNDANCY 存储类。
- 您无法从 INTELLIGENT_TIERING 存储类转换到 STANDARD_IA 存储类。
- 您无法从 ONEZONE_IA 存储类转换为 STANDARD_IA 或 INTELLIGENT_TIERING 存储类。
- 您只能从 GLACIER 存储类转换到 DEEP_ARCHIVE 存储类。
- 您不能从 DEEP_ARCHIVE 存储类转换到任何其他存储类。

生命周期存储类转换具有以下约束：

- 从 STANDARD 或 STANDARD_IA 存储类到 INTELLIGENT_TIERING。以下限制适用：
  - 对于较大的对象，转换到 INTELLIGENT_TIERING 具有成本优势。Amazon S3 不会将小于 128 KB 的对象转换到 INTELLIGENT_TIERING 存储类，因为它不符合成本效益。
- 从 STANDARD 存储类到 STANDARD_IA 或 ONEZONE_IA。以下限制适用：
  - 对于较大的对象，转换到 STANDARD_IA 或 ONEZONE_IA 具有成本优势。Amazon S3 不会将小于 128 KB 的对象转换为 STANDARD_IA 或 ONEZONE_IA 存储类，因为它不符合成本效益。
  - 对象必须在当前存储类中存储至少 30 天，然后才能将它们转换为 STANDARD_IA 或 ONEZONE_IA。例如，您无法在创建对象一天后创建生命周期规则以将对象转换为 STANDARD_IA 存储类。
  - Amazon S3 不会在前 30 天内转换对象，因为与 STANDARD_IA 或 ONEZONE_IA 存储相比，较新的对象通常会更频繁地访问或删除得更快。
  - 如果您要转换非当前对象（在版本化存储桶中），则只能将至少 30 天的非当前对象转换到 STANDARD_IA 或 ONEZONE_IA 存储。
- 从 STANDARD_IA 存储类到 ONEZONE_IA。以下限制适用：

对象必须在 STANDARD_IA 存储类中存储至少 30 天，然后才能将它们转换到 ONEZONE_IA 类。

## 加密

您可以使用 HTTPS 协议（传输中 – SSL/TLS）通过 SSL 端点安全地将数据上传/下载到 Amazon S3 。

加密选项：

![Amazon S3 加密选项](https://cdn-digicloud.pressidium.com/wp-content/uploads/2019/03/Amazon-S3-Encryption-Options-1024x374.jpg)

服务器端加密选项：

- SSE-S3 – 使用 S3 托管密钥的服务器端加密。
  - 每个对象都使用唯一的密钥进行加密。
  - 加密密钥使用主密钥加密。
  - AWS 会定期轮换主密钥。
  - 使用 AES 256。
- SSE-KMS – 使用 AWS KMS 密钥的服务器端加密。
  - KMS 使用客户主密钥 (CMK) 进行加密。
  - 可以使用自动创建的 CMK 密钥。
  - 或者您可以选择自己的密钥（让您控制密钥的管理）。
  - 信封钥匙保护您的钥匙。
  - 收费。
- SSE-C – 使用客户端提供的密钥进行服务器端加密。
  - 客户端管理密钥，S3 管理加密。
  - AWS 不存储加密密钥。
  - 如果密钥丢失，则无法解密数据。

下图描述了启用加密的选项，并显示了加密的应用位置和密钥的管理位置：

![Amazon S3 加密类型](https://cdn-digicloud.pressidium.com/wp-content/uploads/2019/10/Amazon-S3-Encryption-Types-1024x474.jpg)

## 事件通知

可以发送 Amazon S3 事件通知以响应 Amazon S3 中的操作，例如 PUT、POST、COPY 或 DELETE。

Amazon S3 事件通知使您能够运行工作流、发送警报或执行其他操作以响应存储在 S3 中的对象的更改。

要启用通知，您必须首先添加一个通知配置，以标识您希望 Amazon S3 发布的事件以及您希望 Amazon S3 将通知发送到的目标。

您可以配置通过对象键名的前缀和后缀过滤通知。

**Amazon S3 可以发布以下事件的通知：**

- 新对象创建事件。
- 对象移除事件。
- 恢复对象事件。
- 减少冗余存储 (RRS) 对象丢失事件。
- 复制事件。

**Amazon S3 可以将事件通知消息发送到以下目标：**

- 将事件消息发布到 Amazon Simple Notification Service (Amazon SNS) 主题。
- 将事件消息发布到 Amazon Simple Queue Service (Amazon SQS) 队列。
- 通过调用 Lambda 函数并将事件消息作为参数提供，将事件消息发布到 AWS Lambda。

需要授予 Amazon S3 权限以将消息发布到 Amazon SNS 主题或 Amazon SQS 队列。

还需要授予 Amazon S3 权限以代表您调用 AWS Lambda 函数。有关授予这些权限的信息。

## 对象标签

S3 对象标签是应用于 S3 对象的键值对，可以在对象的生命周期内随时创建、更新或删除。

允许您创建身份和访问管理 (IAM) 策略、设置 S3 生命周期策略和自定义存储指标。

每个 S3 对象最多可以添加十个标签，您可以使用 AWS 管理控制台、REST API、AWS CLI 或 AWS 开发工具包来添加对象标签。

## Amazon S3 CloudWatch 指标

您可以使用 AWS 管理控制台为您的 S3 存储桶启用生成 1 分钟 CloudWatch 请求指标或使用前缀或对象标签为指标配置过滤器。

或者，您可以调用 S3 PUT Bucket Metrics API 来启用和配置 S3 存储指标的发布。

CloudWatch 请求指标将在启用后 15 分钟内在 CloudWatch 中可用。

默认情况下，所有存储桶都启用 CloudWatch 存储指标，并且每天报告一次。

可以监控的 S3 指标包括：

- S3 请求。
- 桶存储。
- 桶尺寸。
- 所有请求。
- HTTP 4XX/5XX 错误。

## 跨区域复制

CRR 是一项 Amazon S3 功能，可自动跨 AWS 区域复制数据。

使用 CRR，上传到 S3 存储桶的每个对象都会自动复制到您选择的不同 AWS 区域中的目标存储桶。

在不同区域的存储桶之间提供对象的自动、异步复制。

CRR 在 S3 存储桶级别配置。

您可以通过指定不同区域中的目标存储桶进行复制，在源存储桶上启用 CRR 配置。

您可以使用 AWS 管理控制台、REST API、AWS CLI 或 AWS 开发工具包来启用 CRR。

必须为源和目标存储桶启用版本控制。

源桶和目标桶必须在不同的区域。

使用 CRR，您只能在区域之间进行复制，而不能在区域内进行复制（有关单区域复制，请参阅下面的 SRR）。

复制是 1:1（一个源存储桶，一个目标存储桶）。

您可以在源存储桶和目标存储桶上配置单独的 S3 生命周期规则。

您可以通过在复制配置中提供目标 KMS 密钥来复制 KMS 加密的对象。

您可以跨 AWS 账户设置 CRR，以将复制的数据存储在目标区域的不同账户中。

通过将对象复制到距离用户更近的存储桶，为数据提供低延迟访问。

要激活 CRR，您需要在源存储桶上配置复制：

- 定义另一个区域中要复制到的存储桶。
- 指定复制具有特定键名前缀的所有对象或对象子集。

副本将是精确副本并共享相同的键名和元数据。

您可以指定不同的存储类（默认情况下将使用源存储类）。

AWS S3 将使用 SSL 加密传输中的数据。

AWS S3 必须具有复制对象的权限。

存储桶所有者必须具有读取对象和对象 ACL 的权限。

可以跨账户使用，但源存储桶所有者必须有权将对象复制到目标存储桶中。

复制的触发器是：

- 将对象上传到源存储桶。
- 删除源存储桶中的对象。
- 对对象、其元数据或 ACL 的更改。

复制的内容：

- 启用复制后创建的新对象。
- 对对象的更改。
- 使用 AWS 托管密钥使用 SSE-S3 创建的对象。
- 对象 ACL 更新。

没有复制的内容：

- 启用复制之前存在的对象（可以使用复制 API）。
- 使用 SSE-C 和 SSE-KMS 创建的对象。
- 存储桶所有者没有权限的对象。
- 对存储桶级子资源的更新。
- 生命周期规则中的操作不会被复制。
- 从另一个区域复制的源存储桶中的对象不会被复制。

删除行为：

- 如果在没有指定对象版本 ID 的情况下发出 DELETE 请求，将添加和复制删除标记。
- 如果发出指定对象版本 ID 的 DELETE 请求，则对象将被删除，但不会复制删除标记。

收费：

- 上传请求。
- 跨区域转移。
- 两个区域的 S3 存储。

## 同区域复制 (SRR)

顾名思义，您可以使用 SRR 将对象复制到与源存储桶位于同一区域内的目标存储桶。

此功能于 2018 年 9 月发布。

复制是自动和异步的。

上传到 Amazon S3 存储桶的新对象配置为在存储桶、前缀或对象标签级别进行复制。

复制的对象可以由与原始副本相同的 AWS 账户或不同的账户拥有，以防止意外删除。

复制可以复制到任何 Amazon S3 存储类，包括 S3 Glacier 和 S3 Glacier Deep Archive，以创建备份和长期存档。

当使用 SRR 复制 S3 对象时，与该对象关联的元数据、访问控制列表 (ACL) 和对象标签也是复制的一部分。

在源存储桶上配置 SRR 后，对对象、元数据、ACL 或对象标签的任何更改都会触发到目标存储桶的新复制。

## S3 分析

可以对存储在 Amazon S3 上的数据运行分析。

这包括数据湖、物联网流数据、机器学习和人工智能。

可以使用以下策略：

![S3 分析策略](https://cdn-digicloud.pressidium.com/wp-content/uploads/2019/03/S3-Analytics-Strategies-1024x293.jpg)

## S3 性能指南

AWS为 Amazon S3提供了一些[性能指南](https://docs.aws.amazon.com/AmazonS3/latest/dev/optimizing-performance-guidelines.html)。这些总结如下：

**衡量性能 –**在优化性能时，请查看网络吞吐量、CPU 和 DRAM 要求。根据对这些不同资源的需求组合，可能值得评估不同的 Amazon EC2 实例类型。

**水平**扩展**存储连接 –**您可以通过向 Amazon S3 发出多个并发请求来实现最佳性能。将这些请求分散到不同的连接上，以最大限度地利用 Amazon S3 的可访问带宽。

**使用字节范围**提取**——**在 GET 对象请求中使用范围 HTTP 标头，您可以从对象中提取字节范围，仅传输指定的部分。您可以使用与 Amazon S3 的并发连接从同一对象中获取不同的字节范围。与单个完整对象请求相比，这有助于您实现更高的聚合吞吐量。获取大对象的较小范围还允许您的应用程序在请求中断时缩短重试时间。

**延迟敏感应用程序的重试请求——**积极的超时和重试有助于推动一致的延迟。鉴于 Amazon S3 的规模庞大，如果第一个请求很慢，重试的请求很可能会走不同的路径并很快成功。AWS 开发工具包具有可配置的超时和重试值，您可以根据特定应用程序的容差进行调整。

**在同一 AWS 区域中组合 Amazon S3（存储）和 Amazon EC2（计算）–**尽管 S3 存储桶名称在全球范围内唯一，但每个存储桶都存储在您创建存储桶时选择的区域中。为了优化性能，我们建议您尽可能从同一 AWS 区域中的 Amazon EC2 实例访问存储桶。这有助于减少网络延迟和数据传输成本。

**使用 Amazon S3 Transfer Acceleration 最大限度地减少由距离引起的延迟 –** Amazon S3 Transfer Acceleration 管理在客户端和 S3 存储桶之间远距离传输文件的快速、轻松和安全。Transfer Acceleration 利用 Amazon CloudFront 中全球分布的边缘站点。当数据到达边缘站点时，它会通过优化的网络路径路由到 Amazon S3。Transfer Acceleration 非常适合在各大洲定期传输 GB 到 TB 的数据。它对于从世界各地上传到集中存储桶的客户端也很有用。

## 冰川

Glacier 是一种用于不常访问的数据的归档存储解决方案。

有两个存储层：

**S3冰川。**

- 与 S3 标准相同的低延迟和高吞吐量性能。
- 设计用于单个可用区†中 99.999999999% 的对象的持久性。
- 专为 99.99% 的可用性而设计。
- 以[Amazon S3 服务级别协议](https://aws.amazon.com/s3/sla/) 为后盾以 确保可用性。
- 支持传输中数据的 SSL 和静态数据加密。
- S3 生命周期管理，用于将对象自动迁移到其他 S3 存储类。

**S3 冰川深层档案。**

- 专为跨多个可用区 99.999999999% 的对象而设计。
- 在整个可用区遭到破坏的情况下，数据具有弹性。
- 支持传输中数据的 SSL 和静态数据加密。
- 低成本设计是长期存档的理想选择。
- 可配置的检索时间，从几分钟到几小时不等。
- 用于直接上传到 S3 Glacier 的 S3 PUT API，以及用于自动迁移对象的 S3 生命周期管理。

各层之间的主要区别在于 Deep Archive 成本较低，但检索时间要长得多（12 小时）。

S3 Glacier 层具有从几分钟到几小时的可配置检索时间（您相应地付费）。

存档对象不可用于实时访问，您需要提交检索请求。

Glacier 必须完成一项工作才能获得它的输出。

请求的存档数据被复制到 S3 One Zone-IA。

检索后，您有 24 小时的时间下载您的数据。

您不能在创建对象时将 Glacier 指定为存储类。

冰川旨在承受两个设施的损失。

Glacier 使用 AES 256 对称密钥自动加密静态数据，并支持通过 SSL 安全传输数据。

Glacier 可能并非在所有 AWS 区域都可用。

Glacier 对象仅通过 S3 可见（不是 Glacier 直接可见）。

Glacier 不存档对象元数据，您需要维护一个客户端数据库来维护这些信息。

档案可以是 1 个字节，最高可达 40TB。

1 字节 – 4 GB 的 Glacier 文件存档可以在一次操作中执行。

可以使用分段上传 API 将 100MB 到 40TB 的 Glacier 文件存档上传到 Glacier。

上传档案是同步的。

下载档案是异步的。

已上传的存档内容无法修改。

您可以使用 CLI、开发工具包或 API 将数据上传到 Glacier——您不能使用 AWS 控制台。

当使用生命周期策略从其他类转换时，Glacier 向每个对象添加 32-40KB（索引和存档元数据）。

AWS 建议，如果您有很多小对象，则在上传之前将它们组合在一个存档（例如 zip 文件）中。

可以向档案添加描述，不能添加其他元数据。

Glacier 档案 ID 在上传时添加，并且对于每次上传都是唯一的。

档案检索：

- 加急是 1-5 分钟检索（最昂贵）。
- 标准是 3.5 小时检索（更便宜，每月免费检索 10GB 数据）。
- 批量检索是 5-12 小时（最便宜，用于大量数据）。

您可以检索档案的一部分。

检索数据后，将其复制到 S3，存档保留在 Glacier 中，因此存储类别不会更改。

AWS SNS 可以在检索作业完成时发送通知。

默认情况下，检索到的数据在 24 小时内可用（可以更改）。

要检索存档中的特定对象，您可以在 HTTP GET 请求中指定字节范围（范围）（需要维护字节范围的 DB）。

冰川费用：

EC2和Glacier在同一地区之间的数据传输是免费的。

如果您在 90 天内删除数据，则需要付费。

当您恢复时，您需要支付以下费用：

- 冰川档案。
- 请求。
- S3 上恢复的数据。